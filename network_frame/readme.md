# 需求文档（修订版：包含 UDP 传输层）
## 1.1 项目简介
本项目旨在开发一个网络协议仿真程序，模拟数据从应用层生成，经过传输层（UDP）、网络层（IPv4）、数据链路层（Ethernet II）的封装过程，保存为物理传输文件；以及反向的读取文件与解封装过程。

## 1.2 协议栈设计
系统需模拟以下协议层级结构：
- 应用层 (Layer 5)：用户输入的原始数据（如字符串 "Hello Teacher"）。
- 传输层 (Layer 4)：UDP 协议。负责提供端口号，标识应用程序。
- 网络层 (Layer 3)：IPv4 协议。负责提供源/目的 IP 地址。
- 数据链路层 (Layer 2)：Ethernet II 帧。负责提供源/目的 MAC 地址。

## 1.3 功能模块详解
### A. 封装模块 (Sender)
#### 构建 UDP 数据报
- 在用户数据前添加 8字节 UDP 首部。
- 设置：源端口、目的端口、UDP 长度（首部+数据）、校验和（可选，可置0）。

#### 构建 IP 数据报
- 在 UDP 数据报前添加 20字节 IP 首部（假设无选项字段）。
- 设置：版本(4)、首部长度(5)、总长度（20+UDP长度）、TTL、协议号（17 代表 UDP）、源/目的 IP。

#### 构建以太网帧
- 在 IP 数据报前添加 14字节 以太网首部。
- 设置：目的 MAC、源 MAC、类型字段（0x0800 代表 IPv4）。

#### 物理存储
- 将最终拼接好的二进制 Buffer 写入文件 packet.bin。

### B. 解封装模块 (Receiver)
#### 读取文件
将 packet.bin 读入内存缓冲区。

#### 解析以太网
- 读取前 14 字节，提取 MAC 地址，判断类型是否为 0x0800。
- 偏移指针 +14。

#### 解析 IP
- 读取接下来的 20 字节，提取 IP 地址，判断协议号是否为 17 (UDP)。
- 偏移指针 +20。

#### 解析 UDP
- 读取接下来的 8 字节，提取端口号。
- 偏移指针 +8。

#### 还原数据
- 读取剩余字节，将其作为字符串输出。